<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kurye GÃ¼nlÃ¼k Takip</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
body { font-family: Arial; padding: 20px; }
input, button, select { padding: 8px; margin: 6px 0; width: 100%; }
.toplam { font-weight: bold; margin-top: 10px; }
.panel { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
</style>
</head>
<body>

<h2>Kurye GÃ¼nlÃ¼k Takip</h2>

<div class="panel">
<b>KayÄ±t TÃ¼rÃ¼</b>
<select id="tur">
<option value="teslimat">Teslimat</option>
<option value="tahsilat">Devir Teslim AlÄ±nan</option>
</select>
</div>

<input id="isletme" placeholder="Ä°ÅŸletme AdÄ±">
<input id="paket" type="number" min="0" placeholder="Paket SayÄ±sÄ± (teslimat)">
<input id="ucret" type="number" min="0" placeholder="Paket Ãœcreti / Tahsilat TL">

<button onclick="kaydet()">Kaydet</button>
<button onclick="gunBitir()">GÃ¼nÃ¼ Bitir & Excel</button>

<div class="toplam" id="toplamYazi"></div>
<ul id="liste"></ul>

<script>
let kayitlar = [];
let devirler = JSON.parse(localStorage.getItem("isletmeDevirleri") || "{}");

/* ðŸ” SAYFA AÃ‡ILINCA DEVÄ°RLERÄ° GÃ–STER */
window.onload = function () {
  for (const isletme in devirler) {
    kayitlar.push({
      Isletme: isletme,
      Tur: "devreden",
      Paket: 0,
      Birim: "",
      Tutar: devirler[isletme]
    });
  }
  listele();
};

function kaydet() {
  const isletme = document.getElementById("isletme").value;
  const paket = Number(document.getElementById("paket").value);
  const ucret = Number(document.getElementById("ucret").value);
  const tur = document.getElementById("tur").value;
  if (!isletme) return;

  let tutar = 0;
  let paketSayisi = 0;

  if (tur === "teslimat") {
    tutar = paket * ucret;
    paketSayisi = paket;
    devirler[isletme] = (devirler[isletme] || 0) + tutar;
  }

  if (tur === "tahsilat") {
    tutar = -ucret;
    devirler[isletme] = (devirler[isletme] || 0) - ucret;
  }

  kayitlar.push({
    Isletme: isletme,
    Tur: tur === "teslimat" ? "Teslimat" : "Tahsilat",
    Paket: paketSayisi,
    Birim: ucret,
    Tutar: tutar
  });

  document.getElementById("isletme").value = "";
  document.getElementById("paket").value = "";
  document.getElementById("ucret").value = "";

  listele();
}

function listele() {
  let toplamPaket = 0;
  let toplamBakiye = 0;
  const ul = document.getElementById("liste");
  ul.innerHTML = "";

  for (const isletme in devirler) {
    toplamBakiye += devirler[isletme];
  }

  kayitlar.forEach(k => {
    toplamPaket += k.Paket;
    const li = document.createElement("li");
    if (k.Tur === "Teslimat") {
      li.textContent = `${k.Isletme} â†’ ${k.Paket} x ${k.Birim} TL = ${k.Tutar} TL`;
    } else if (k.Tur === "Tahsilat") {
      li.textContent = `${k.Isletme} â†’ Tahsilat: ${Math.abs(k.Tutar)} TL`;
    } else {
      li.textContent = `${k.Isletme} â†’ DEVÄ°R: ${k.Tutar} TL`;
    }
    ul.appendChild(li);
  });

  document.getElementById("toplamYazi").innerText =
    `Toplam Paket: ${toplamPaket} | Toplam Kalan Devir: ${toplamBakiye} TL`;
}

function gunBitir() {
  const excelData = [];

  for (const isletme in devirler) {
    excelData.push({
      Isletme: isletme,
      KalanDevirTL: devirler[isletme]
    });
  }

  localStorage.setItem("isletmeDevirleri", JSON.stringify(devirler));

  const ws = XLSX.utils.json_to_sheet(excelData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Devirler");

  const tarih = new Date().toISOString().slice(0,10);
  XLSX.writeFile(wb, `devir_durumu_${tarih}.xlsx`);

  kayitlar = [];
  listele();
}
</script>

</body>
</html>
