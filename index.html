<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kurye & Ä°ÅŸletme Takip</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#0f172a;--card:#1e293b;--soft:#334155;--blue:#3b82f6;
  --yellow:#facc15;--red:#ef4444;--green:#22c55e;--text:#e5e7eb
}
*{box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:sans-serif;padding:10px}
.tabbar{display:flex;gap:6px;margin-bottom:10px}
.tabbar button{flex:1;padding:10px;border:none;border-radius:8px;font-weight:bold}
.active{background:var(--blue);color:#fff}
.passive{background:var(--soft);color:#94a3b8}
.card{background:var(--card);padding:10px;border-radius:10px;margin-bottom:10px}
.summary{display:flex;gap:8px;margin:10px 0}
.summary .box{flex:1;background:var(--card);padding:10px;border-radius:10px;font-size:14px;text-align:center}
.summary .kurye{border-left:4px solid var(--blue)}
.summary .isletme{border-left:4px solid var(--red)}

input,select,button{width:100%;padding:8px;margin:4px 0;border:none;border-radius:8px}
input,select{background:var(--soft);color:#fff}
button{background:var(--blue);color:#fff;font-weight:bold}
button.warn{background:var(--yellow);color:#000}
button.small{padding:4px;font-size:11px}
table{width:100%;border-collapse:collapse;font-size:12px;margin-top:6px;table-layout:fixed}
th,td{padding:6px;border-bottom:1px solid var(--soft);text-align:center}
.icon{width:8px;height:8px;border-radius:50%;display:inline-block}
.red{background:var(--red)} .blue{background:var(--blue)} .green{background:var(--green)}
.actions button{background:#475569;margin:0 2px}
.section{margin-top:10px;padding-top:8px;border-top:1px solid var(--soft)}
.hidden{display:none}
</style>
</head>

<body>

<div class="tabbar">
  <button id="tKurye" class="active" onclick="tab('kurye')">KURYELER</button>
  <button id="tIsletme" class="passive" onclick="tab('isletme')">Ä°ÅžLETMELER</button>
</div>

<div id="kurye"></div>
<div id="isletme" class="hidden"></div>

<!-- ðŸ”¢ Ã–ZET ALANI -->
<div class="summary">
  <div class="box kurye">
    <b>Kuryelere Toplam Ã–deme</b><br>
    <span id="kuryeToplam">0 â‚º</span>
  </div>
  <div class="box isletme">
    <b>Ä°ÅŸletmelerden Toplam Alacak</b><br>
    <span id="isletmeToplam">0 â‚º</span>
  </div>
</div>

<button class="warn" onclick="gunSonu()">GÃœN SONU AL</button>
<button onclick="excel()">EXCEL AKTAR</button>

<script>
let today=new Date().toLocaleDateString();
let data=JSON.parse(localStorage.getItem('takip'))||{kurye:[],isletme:[]};
let devirData=JSON.parse(localStorage.getItem('devir'))||{kurye:[],isletme:[]};

function save(){
  localStorage.setItem('takip',JSON.stringify(data));
  localStorage.setItem('devir',JSON.stringify(devirData));
  render();
}

function tab(x){
  kurye.classList.add('hidden'); isletme.classList.add('hidden');
  tKurye.className='passive'; tIsletme.className='passive';
  document.getElementById(x).classList.remove('hidden');
  document.getElementById('t'+x.charAt(0).toUpperCase()+x.slice(1)).className='active';
}

function icon(t){return t>0?'blue':t<0?'red':'green';}

function ekle(type,ad,paket,ucret){
  if(!ad) return alert('Ä°sim girin');
  paket=Number(paket)||0; ucret=Number(ucret)||0;
  data[type].push({ad,paket,tutar:paket*ucret,gun:today});
  save();
}

function sil(type,i){
  if(confirm('Silmek istiyor musunuz?')){
    data[type].splice(i,1); save();
  }
}

function gunSonu(){
 ['kurye','isletme'].forEach(type=>{
  let map={};
  data[type].forEach(x=>map[x.ad]=(map[x.ad]||0)+x.tutar);
  Object.entries(map).forEach(([ad,toplam])=>{
    if(toplam===0) return;
    let m=devirData[type].find(d=>d.ad===ad);
    if(m) m.tutar+=toplam;
    else devirData[type].push({ad,tutar:toplam});
  });
  data[type]=[];
 });
 save();
}

function excel(){
 let wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(data.kurye),'Gunluk_Kurye');
 XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(data.isletme),'Gunluk_Isletme');
 XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(devirData.kurye),'Devir_Kurye');
 XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(devirData.isletme),'Devir_Isletme');
 XLSX.writeFile(wb,'Kurye_Takip.xlsx');
}

function tablo(type){
 return `<table>
 <tr><th></th><th>Ad</th><th>Paket</th><th>Tutar</th><th></th></tr>
 ${data[type].map((x,i)=>`
 <tr>
  <td><span class="icon ${icon(x.tutar)}"></span></td>
  <td>${x.ad}</td><td>${x.paket}</td><td>${x.tutar}</td>
  <td class="actions"><button class="small" onclick="sil('${type}',${i})">ðŸ—‘</button></td>
 </tr>`).join('')}
 </table>`;
}

function render(){
  kurye.innerHTML=`
    <div class="card">
      <input id="ka" placeholder="Kurye adÄ±">
      <input id="kp" type="number" placeholder="Paket">
      <input id="ku" type="number" placeholder="Ãœcret">
      <button onclick="ekle('kurye',ka.value,kp.value,ku.value)">GÃœNLÃœK EKLE</button>
    </div>
    ${tablo('kurye')}
  `;

  isletme.innerHTML=`
    <div class="card">
      <input id="ia" placeholder="Ä°ÅŸletme adÄ±">
      <input id="ip" type="number" placeholder="Paket">
      <input id="iu" type="number" placeholder="Ãœcret">
      <button onclick="ekle('isletme',ia.value,ip.value,iu.value)">GÃœNLÃœK EKLE</button>
    </div>
    ${tablo('isletme')}
  `;

  document.getElementById('kuryeToplam').innerText =
    devirData.kurye.filter(x=>x.tutar>0).reduce((s,x)=>s+x.tutar,0)+' â‚º';

  document.getElementById('isletmeToplam').innerText =
    devirData.isletme.filter(x=>x.tutar<0).reduce((s,x)=>s+Math.abs(x.tutar),0)+' â‚º';
}

render();
</script>
</body>
</html>
