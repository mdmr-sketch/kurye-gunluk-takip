<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kurye & Ä°ÅŸletme Takip</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
body{background:#0f172a;color:#e5e7eb;font-family:sans-serif;padding:10px}
input,select,button{padding:8px;border:none;border-radius:6px;margin:2px 0}
input,select{background:#334155;color:#fff;width:100%}
button{background:#3b82f6;color:#fff;font-weight:bold;cursor:pointer}
button.small{padding:2px 6px;font-size:12px;margin:0 2px}
.card{background:#1e293b;padding:10px;border-radius:10px;margin-bottom:10px}
.tabbar{display:flex;gap:6px;margin-bottom:10px}
.tabbar button{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;font-weight:bold;padding:10px;border-radius:8px}
.active{background:#3b82f6}
.passive{background:#334155;color:#94a3b8}
.hidden{display:none}
table{width:100%;font-size:12px;border-collapse:collapse;margin-top:6px;table-layout:fixed}
th,td{padding:6px;border-bottom:1px solid #334155;text-align:center}
.actions{display:flex;justify-content:center}
.actions button{margin:0 2px;padding:2px 6px;font-size:12px}
.logo{text-align:center;font-size:48px;margin:5px 0}
.input-group{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px}
.input-group input{flex:1;min-width:80px}
.input-group button{flex:none}
.flex-btns{display:flex;gap:10px;margin-bottom:10px}
.flex-btns button{flex:1;padding:10px;font-weight:bold}
#odemeGirBtn{display:block;margin:10px auto;}
.summary{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.summary-card{background:#020617;padding:12px;border-radius:14px}
.pay{border-left:4px solid #ef4444}
.get{border-left:4px solid #22c55e}
</style>
</head>
<body>

<div class="tabbar">
 <button id="tKurye" class="active" onclick="tab('kurye')">ğŸ›µ KURYELER</button>
 <button id="tIsletme" class="passive" onclick="tab('isletme')">ğŸ• Ä°ÅLETMELER</button>
</div>

<div id="kurye"></div>
<div id="isletme" class="hidden"></div>

<div class="card">
 <b>ğŸ’³ Ã–DEME</b>
 <select id="odemeTip">
  <option value="kurye">Kurye</option>
  <option value="isletme">Ä°ÅŸletme</option>
 </select>
 <select id="odemeAd"></select>
 <input type="number" id="odemeTutar" placeholder="Tutar">
 <button id="odemeGirBtn" onclick="odemeGir()">Ã–DEME YAP</button>

 <div class="summary">
  <div class="summary-card pay">Kuryelere: <b id="topKurye">0 â‚º</b></div>
  <div class="summary-card get">Ä°ÅŸletmelerden: <b id="topIsletme">0 â‚º</div>
 </div>
</div>

<b>Ã–deme GeÃ§miÅŸi</b>
<div id="odemeTablo"></div>

<div class="flex-btns">
 <button onclick="gunSonu()">GÃœN SONU AL</button>
 <button onclick="excelAktar()">ğŸ“¤ EXCEL AKTAR</button>
</div>

<script>
let data=JSON.parse(localStorage.getItem("takip"))||{kurye:[],isletme:[]}
let devir=JSON.parse(localStorage.getItem("devir"))||{kurye:[],isletme:[]}
let odemeler=JSON.parse(localStorage.getItem("odemeler"))||[]
let lastValues={kurye:{paket:'',ucret:''},isletme:{paket:'',ucret:''}}

function save(){localStorage.setItem("takip",JSON.stringify(data));localStorage.setItem("devir",JSON.stringify(devir));localStorage.setItem("odemeler",JSON.stringify(odemeler));render()}

function tab(x){
 kurye.classList.add("hidden");isletme.classList.add("hidden")
 tKurye.classList.remove("active");tIsletme.classList.remove("active")
 document.getElementById(x).classList.remove("hidden")
 document.getElementById("t"+x.charAt(0).toUpperCase()+x.slice(1)).classList.add("active")
}

function ekle(t,a,p,u){
 if(!a) return alert("Ä°sim gir")
 p=+p; u=+u
 data[t].push({ad:a,paket:p,ucret:u,tutar:p*u,gun:new Date().toLocaleDateString()})
 lastValues[t]={paket:p,ucret:u}
 save()
}

function sil(t,i){if(confirm("Silinsin mi?")){data[t].splice(i,1);save()}}

function gunSonu(){
 ["kurye","isletme"].forEach(t=>{
  let map={}
  data[t].forEach(x=>map[x.ad]=(map[x.ad]||0)+x.tutar)
  Object.entries(map).forEach(([ad,top])=>{
   let d=devir[t].find(x=>x.ad===ad)
   d?d.tutar+=top:devir[t].push({ad,tutar:top})
  })
  data[t]=[]
 })
 save()
}

function odemeGir(){
 let t=odemeTip.value,a=odemeAd.value,tu=+odemeTutar.value
 if(!a||!tu) return
 let d=devir[t].find(x=>x.ad===a)
 if(d)d.tutar=Math.max(0,d.tutar-tu)
 odemeler.push({tarih:new Date().toLocaleDateString(),tip:t,ad:a,tutar:tu})
 save()
}

function excelAktar(){
 let wb=XLSX.utils.book_new()

 // GÃ¼nlÃ¼k iÅŸlemler ayrÄ± sayfa
 ["kurye","isletme"].forEach(t=>{
   let arr=data[t].map(x=>({Ad:x.ad,Paket:x.paket,Ãœcret:x.ucret,Toplam:x.tutar}))
   let ws=XLSX.utils.json_to_sheet(arr)
   XLSX.utils.book_append_sheet(wb,ws,"GÃœNLÃœK_"+t.toUpperCase())
 })

 // Devir ayrÄ± sayfa
 let devirRows=[]
 devir.kurye.forEach(x=>devirRows.push({Tip:"Kurye",Ad:x.ad,Tutar:x.tutar}))
 devir.isletme.forEach(x=>devirRows.push({Tip:"Ä°ÅŸletme",Ad:x.ad,Tutar:x.tutar}))
 let wsDevir=XLSX.utils.json_to_sheet(devirRows)
 XLSX.utils.book_append_sheet(wb,wsDevir,"DEViR")

 XLSX.writeFile(wb,"kurye_takip.xlsx")
}

function render(){
 function tablo(arr,t){
  return `<table><tr><th>Ad</th><th>Paket</th><th>Ãœcret</th><th>Toplam</th><th>Ä°ÅŸlem</th></tr>`+
  arr.map((x,i)=>`<tr>
<td>${x.ad}</td>
<td>${x.paket||0}</td>
<td>${x.ucret||0}</td>
<td>${x.tutar||0}</td>
<td class="actions">
<button class="small" onclick="promptDuzenle('${t}',${i})">âœï¸</button>
<button class="small" onclick="sil('${t}',${i})">ğŸ—‘</button>
</td></tr>`).join("")+
  `</table>`
 }

 window.promptDuzenle=function(t,i){
  let item=data[t][i]
  let ad=prompt("Ä°sim:",item.ad)
  let paket=prompt("Paket:",item.paket)
  let ucret=prompt("Ãœcret:",item.ucret)
  if(ad!==null)item.ad=ad
  if(paket!==null)item.paket=+paket
  if(ucret!==null)item.ucret=+ucret
  item.tutar=item.paket*item.ucret
  save()
 }

 kurye.innerHTML=`
 <div class="card">
  <div class="input-group">
    <input id="ka" placeholder="Kurye AdÄ±" value="">
    <input id="kp" type="number" placeholder="Paket" value="${lastValues.kurye.paket}">
    <input id="ku" type="number" placeholder="Ãœcret" value="${lastValues.kurye.ucret}">
    <button onclick="ekle('kurye',ka.value,kp.value,ku.value)">EKLE</button>
  </div>
 </div>
 <b>GÃ¼nlÃ¼k</b>${tablo(data.kurye,'kurye')}
 <b>Devir</b>${tablo(devir.kurye,'kurye')}
 `

 isletme.innerHTML=`
 <div class="card">
  <div class="input-group">
    <input id="ia" placeholder="Ä°ÅŸletme AdÄ±" value="">
    <input id="ip" type="number" placeholder="Paket" value="${lastValues.isletme.paket}">
    <input id="iu" type="number" placeholder="Ãœcret" value="${lastValues.isletme.ucret}">
    <button onclick="ekle('isletme',ia.value,ip.value,iu.value)">EKLE</button>
  </div>
 </div>
 <b>GÃ¼nlÃ¼k</b>${tablo(data.isletme,'isletme')}
 <b>Devir</b>${tablo(devir.isletme,'isletme')}
 `

 topKurye.innerText=devir.kurye.reduce((a,b)=>a+b.tutar,0)+" â‚º"
 topIsletme.innerText=devir.isletme.reduce((a,b)=>a+b.tutar,0)+" â‚º"
 odemeAd.innerHTML=""
 new Set(devir[odemeTip.value].map(x=>x.ad)).forEach(a=>odemeAd.add(new Option(a,a)))
 odemeTablo.innerHTML=tablo(odemeler,'odeme')
}

odemeTip.onchange=render
render()
</script>
</body>
</html>
