<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kurye Takip Final</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{
  background:#0f172a;
  color:#f1f5f9;
  font-family:sans-serif;
  margin:0;
  padding:15px;
  display:flex;
  justify-content:center;
}
.container{width:100%;max-width:900px;}
h2{font-size:17px;color:#38bdf8;border-bottom:1px solid #334155;padding-bottom:5px;margin-top:20px;}
.section{padding:10px 0;margin-bottom:15px;border-bottom:1px solid #334155;}
input,select,button{width:100%;padding:10px;margin:5px 0;border-radius:6px;border:none;font-size:14px;}
input,select{background:#334155;color:#f1f5f9;}
button{background:#3b82f6;color:#fff;font-weight:bold;cursor:pointer;}
button.warn{background:#facc15;color:#000;}
button.danger{background:#ef4444;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px;}
th,td{border-bottom:1px solid #334155;padding:8px;text-align:center;}
th{background:#0f172a;color:#7dd3fc;}
.status{width:10px;height:10px;border-radius:50%;display:inline-block;}
.red{background:#ef4444}.green{background:#22c55e}
.isletmeCell{display:flex;align-items:center;justify-content:center;gap:6px;}
</style>
</head>

<body onload="yenile()">
<div class="container">

<div class="section">
<h2>ðŸ“¦ GÃ¼nlÃ¼k Ä°ÅŸlem</h2>
<input id="isletme" placeholder="Ä°ÅŸletme adÄ±">
<input id="paket" type="number" placeholder="Paket sayÄ±sÄ±">
<input id="ucret" type="number" placeholder="Paket Ã¼creti">
<input id="tahsilat" type="number" placeholder="Tahsil edilen">
<button onclick="ekle()">Kaydet</button>
</div>

<div class="section">
<h2>ðŸ“‹ GÃ¼nlÃ¼k KayÄ±tlar</h2>
<table>
<thead>
<tr>
<th>Tarih</th><th>Ä°ÅŸletme</th><th>Ä°ÅŸlem</th><th>Paket</th><th>Tutar</th><th>Tahsilat</th><th>Kalan</th>
</tr>
</thead>
<tbody id="liste"></tbody>
</table>
</div>

<div class="section">
<h2>ðŸ“Œ GÃ¼ncel Durum (Devreden)</h2>
<table>
<thead><tr><th>Ä°ÅŸletme</th><th>Kalan Bakiye</th></tr></thead>
<tbody id="devirListe"></tbody>
</table>
</div>

<div class="section">
<button onclick="excel()">ðŸ“¥ Excel Ä°ndir</button>
<button class="warn" onclick="gunSonuAl()">ðŸ§¾ GÃ¼n Sonu Al (GÃ¼nlÃ¼k Excel)</button>
</div>

<script>
let kayitlar = JSON.parse(localStorage.getItem("gunlukKayitlar")) || [];
let devirler = JSON.parse(localStorage.getItem("isletmeDevirleri")) || {};
const bugun=()=>new Date().toISOString().slice(0,10);
const n=x=>x.trim().toUpperCase();

function ekle(){
  const i=n(isletme.value),p=+paket.value||0,u=+ucret.value||0,t=+tahsilat.value||0;
  if(!i) return alert("Ä°ÅŸletme gir");
  if(!devirler[i]) devirler[i]=0;
  let etki=0,islem="";
  if(p>0&&u>0){etki=p*u-t;islem="Teslimat"}
  else if(t>0){etki=-t;islem="Tahsilat"}
  else return alert("Eksik bilgi");
  kayitlar.push({Tarih:bugun(),Isletme:i,Islem:islem,Paket:p||"",Tutar:p*u||"",Tahsilat:t,Etki:etki});
  devirler[i]+=etki;
  kaydet();
}

function kaydet(){
  localStorage.setItem("gunlukKayitlar",JSON.stringify(kayitlar));
  localStorage.setItem("isletmeDevirleri",JSON.stringify(devirler));
  paket.value=ucret.value=tahsilat.value="";
  yenile();
}

function yenile(){
  liste.innerHTML="";let bakiye={};
  kayitlar.forEach(k=>{
    if(!bakiye[k.Isletme]) bakiye[k.Isletme]=0;
    bakiye[k.Isletme]+=k.Etki;
    liste.innerHTML+=`
    <tr>
      <td>${k.Tarih}</td>
      <td>${k.Isletme}</td>
      <td>${k.Islem}</td>
      <td>${k.Paket||"-"}</td>
      <td>${k.Tutar||"-"}</td>
      <td>${k.Tahsilat||"-"}</td>
      <td>${bakiye[k.Isletme]}</td>
    </tr>`;
  });
  devirListe.innerHTML="";
  Object.keys(devirler).forEach(i=>{
    devirListe.innerHTML+=`<tr><td>${i}</td><td>${devirler[i]} TL</td></tr>`;
  });
}

function excel(){
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(kayitlar),"Gunluk");
  XLSX.writeFile(wb,"Kurye_Takip.xlsx");
}

function gunSonuAl(){
  if(!confirm("GÃ¼n sonu alÄ±nacak.\nGÃ¼nlÃ¼k Excel oluÅŸturulacak.\nDevam edilsin mi?")) return;
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(kayitlar),"Gunluk");
  XLSX.utils.book_append_sheet(
    wb,
    XLSX.utils.json_to_sheet(
      Object.keys(devirler).map(i=>({Isletme:i,Bakiye:devirler[i]}))
    ),
    "Devreden"
  );
  XLSX.writeFile(wb,`Kurye_Takip_${bugun()}.xlsx`);
  kayitlar=[];
  localStorage.setItem("gunlukKayitlar","[]");
  yenile();
  alert("GÃ¼n sonu alÄ±ndÄ±. Ertesi gÃ¼ne hazÄ±r.");
}
</script>
</div>
</body>
</html>
