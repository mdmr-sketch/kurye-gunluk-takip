<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kurye GÃ¼nlÃ¼k Takip</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body { font-family: Arial, sans-serif; padding: 10px; }
h3, h4 { margin-top: 20px; }
input, button, select { width: 100%; padding: 8px; margin: 5px 0; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
.danger { background:#d9534f; color:#fff; border:none; }
.warning { background:#f0ad4e; color:#fff; border:none; }
</style>
</head>

<body>

<h3>ğŸ“¦ Kurye GÃ¼nlÃ¼k Takip</h3>

<input id="isletme" placeholder="Ä°ÅŸletme adÄ±">
<input id="paket" type="number" placeholder="AtÄ±lan paket (tahsilatta boÅŸ)">
<input id="ucret" type="number" placeholder="Paket Ã¼creti (tahsilatta boÅŸ)">
<input id="tahsilat" type="number" placeholder="Tahsil edilen (TL)">

<button onclick="ekle()">â• Kaydet</button>

<h4>ğŸ“‹ GÃ¼nlÃ¼k KayÄ±tlar</h4>
<table>
<thead>
<tr>
  <th>Ä°ÅŸletme</th>
  <th>Ä°ÅŸlem</th>
  <th>Paket</th>
  <th>Birim</th>
  <th>Tutar</th>
  <th>Tahsilat</th>
</tr>
</thead>
<tbody id="liste"></tbody>
</table>

<h4>ğŸ§¹ GÃ¼nlÃ¼k KayÄ±t Sil</h4>
<select id="silIsletme"></select>
<button class="warning" onclick="gunlukKayitSil()">ğŸ—‘ï¸ SeÃ§ili Ä°ÅŸletmenin GÃ¼nlÃ¼k KayÄ±tlarÄ±nÄ± Sil</button>

<h4>ğŸ” Devreden BorÃ§lar</h4>
<table>
<thead>
<tr>
  <th>Ä°ÅŸletme</th>
  <th>Kalan Devir (TL)</th>
</tr>
</thead>
<tbody id="devirListe"></tbody>
</table>

<button class="danger" onclick="devirleriSil()">ğŸ—‘ï¸ TÃ¼m Devirleri SÄ±fÄ±rla</button>

<h4>ğŸ“Š GÃ¼n Sonu</h4>
<button onclick="gunBitir()">ğŸ“¥ GÃ¼nÃ¼ Bitir & Excel Ä°ndir</button>

<script>
let kayitlar = JSON.parse(localStorage.getItem("gunlukKayitlar")) || [];
let devirler = JSON.parse(localStorage.getItem("isletmeDevirleri")) || {};

function normalizeIsletme(ad) {
  return ad.trim().toUpperCase();
}

/* === KAYIT EKLE === */
function ekle() {
  const isletme = normalizeIsletme(document.getElementById("isletme").value);
  const paket = Number(document.getElementById("paket").value || 0);
  const ucret = Number(document.getElementById("ucret").value || 0);
  const tahsilat = Number(document.getElementById("tahsilat").value || 0);

  if (!isletme) {
    alert("Ä°ÅŸletme adÄ± zorunlu");
    return;
  }

  if (paket === 0 && ucret === 0 && tahsilat > 0) {
    if (!devirler[isletme]) devirler[isletme] = 0;
    devirler[isletme] -= tahsilat;

    kayitlar.push({
      Isletme: isletme,
      Islem: "Devir Tahsilat",
      Paket: "",
      Birim: "",
      Tutar: "",
      Tahsilat: tahsilat
    });
  }
  else if (paket > 0 && ucret > 0) {
    const tutar = paket * ucret;
    if (!devirler[isletme]) devirler[isletme] = 0;
    devirler[isletme] += tutar - tahsilat;

    kayitlar.push({
      Isletme: isletme,
      Islem: "Teslimat",
      Paket: paket,
      Birim: ucret,
      Tutar: tutar,
      Tahsilat: tahsilat
    });
  }
  else {
    alert("Teslimat iÃ§in paket+Ã¼cret, tahsilat iÃ§in sadece tahsilat gir");
    return;
  }

  localStorage.setItem("gunlukKayitlar", JSON.stringify(kayitlar));
  localStorage.setItem("isletmeDevirleri", JSON.stringify(devirler));

  document.getElementById("paket").value = "";
  document.getElementById("ucret").value = "";
  document.getElementById("tahsilat").value = "";

  listele();
  devirListele();
  isletmeDoldur();
}

/* === GÃœNLÃœK LÄ°STE === */
function listele() {
  const tbody = document.getElementById("liste");
  tbody.innerHTML = "";

  kayitlar.forEach(k => {
    tbody.innerHTML += `
      <tr>
        <td>${k.Isletme}</td>
        <td>${k.Islem}</td>
        <td>${k.Paket || "-"}</td>
        <td>${k.Birim || "-"}</td>
        <td>${k.Tutar || "-"}</td>
        <td>${k.Tahsilat || "-"}</td>
      </tr>`;
  });
}

/* === DEVÄ°R === */
function devirListele() {
  const tbody = document.getElementById("devirListe");
  tbody.innerHTML = "";

  for (let i in devirler) {
    if (devirler[i] !== 0) {
      tbody.innerHTML += `
        <tr>
          <td>${i}</td>
          <td>${devirler[i]} TL</td>
        </tr>`;
    }
  }
}

/* === Ä°ÅLETME SELECT === */
function isletmeDoldur() {
  const select = document.getElementById("silIsletme");
  const isletmeler = [...new Set(kayitlar.map(k => k.Isletme))];

  select.innerHTML = `<option value="">Ä°ÅŸletme SeÃ§</option>`;
  isletmeler.forEach(i => {
    select.innerHTML += `<option value="${i}">${i}</option>`;
  });
}

/* === GÃœNLÃœK KAYIT SÄ°L === */
function gunlukKayitSil() {
  const isletme = document.getElementById("silIsletme").value;
  if (!isletme) {
    alert("LÃ¼tfen iÅŸletme seÃ§");
    return;
  }

  const onay = confirm(
    isletme + " iÅŸletmesine ait TÃœM gÃ¼nlÃ¼k kayÄ±tlar silinecek.\n\nDevirler etkilenmez.\n\nEmin misiniz?"
  );

  if (!onay) return;

  kayitlar = kayitlar.filter(k => k.Isletme !== isletme);
  localStorage.setItem("gunlukKayitlar", JSON.stringify(kayitlar));

  listele();
  isletmeDoldur();

  alert(isletme + " gÃ¼nlÃ¼k kayÄ±tlarÄ± silindi.");
}

/* === TÃœM DEVÄ°RLERÄ° SÄ°L === */
function devirleriSil() {
  const onay = confirm(
    "TÃœM devreden borÃ§lar silinecek!\n\nBu iÅŸlem geri alÄ±namaz.\n\nEmin misiniz?"
  );

  if (!onay) return;

  devirler = {};
  localStorage.removeItem("isletmeDevirleri");

  devirListele();
  alert("TÃ¼m devirler sÄ±fÄ±rlandÄ±.");
}

/* === GÃœN BÄ°TÄ°R === */
function gunBitir() {
  const wb = XLSX.utils.book_new();

  XLSX.utils.book_append_sheet(
    wb,
    XLSX.utils.json_to_sheet(kayitlar),
    "Gunluk_Kayitlar"
  );

  const devirSheet = [];
  for (let i in devirler) {
    devirSheet.push({ Isletme: i, KalanDevirTL: devirler[i] });
  }
  XLSX.utils.book_append_sheet(
    wb,
    XLSX.utils.json_to_sheet(devirSheet),
    "Devirler"
  );

  const tarih = new Date().toISOString().slice(0,10);
  XLSX.writeFile(wb, `kurye_${tarih}.xlsx`);

  kayitlar = [];
  localStorage.removeItem("gunlukKayitlar");

  listele();
  isletmeDoldur();
  devirListele();
}

/* === SAYFA AÃ‡ILINCA === */
listele();
devirListele();
isletmeDoldur();
</script>

</body>
</html>
