<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kurye & Ä°ÅŸletme Takip</title>
<style>
:root{
 --bg:#0f172a;--card:#1e293b;--soft:#334155;
 --blue:#3b82f6;--red:#ef4444;--green:#22c55e;--text:#e5e7eb
}
*{box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:sans-serif;padding:10px}
button,input,select{width:100%;padding:8px;margin:4px 0;border:none;border-radius:8px}
input,select{background:var(--soft);color:#fff}
button{background:var(--blue);color:#fff;font-weight:bold}
.card{background:var(--card);padding:10px;border-radius:10px;margin-bottom:10px}
.tabbar{display:flex;gap:6px;margin-bottom:10px}
.tabbar button{flex:1}
.active{background:var(--blue)}
.hidden{display:none}
table{width:100%;font-size:12px;border-collapse:collapse;margin-top:6px}
th,td{padding:6px;border-bottom:1px solid var(--soft);text-align:center}
.icon{width:8px;height:8px;border-radius:50%;display:inline-block}
.red{background:var(--red)}
.blue{background:var(--blue)}
.green{background:var(--green)}
.actions{display:flex;gap:6px;justify-content:center}
.actions button{
 width:auto;
 padding:4px 6px;
 font-size:13px;
 background:#475569;
}
</style>
</head>
<body>

<div class="tabbar">
 <button id="tKurye" class="active" onclick="tab('kurye')">KURYELER</button>
 <button id="tIsletme" onclick="tab('isletme')">Ä°ÅLETMELER</button>
</div>

<div id="kurye"></div>
<div id="isletme" class="hidden"></div>

<div class="card">
 <b>Ã–DEME GÄ°RÄ°ÅÄ°</b>
 <select id="odemeTip">
   <option value="kurye">Kurye</option>
   <option value="isletme">Ä°ÅŸletme</option>
 </select>
 <select id="odemeAd"></select>
 <input type="number" id="odemeTutar" placeholder="Ã–denecek Tutar">
 <button onclick="odemeGir()">Ã–DEME YAP</button>
</div>

<b>Ã–deme Tablosu</b>
<div id="odemeTablo"></div>

<button onclick="gunSonu()">GÃœN SONU AL</button>
<button onclick="excelAktar()">EXCEL DIÅA AKTAR</button>

<script>
let data=JSON.parse(localStorage.getItem("takip"))||{kurye:[],isletme:[]}
let devir=JSON.parse(localStorage.getItem("devir"))||{kurye:[],isletme:[]}
let odemeler=JSON.parse(localStorage.getItem("odemeler"))||[]
let last={kurye:{p:'',u:''},isletme:{p:'',u:''}}

function save(){
 localStorage.setItem("takip",JSON.stringify(data))
 localStorage.setItem("devir",JSON.stringify(devir))
 localStorage.setItem("odemeler",JSON.stringify(odemeler))
 render()
}

function tab(x){
 kurye.classList.add("hidden")
 isletme.classList.add("hidden")
 tKurye.classList.remove("active")
 tIsletme.classList.remove("active")
 document.getElementById(x).classList.remove("hidden")
 document.getElementById("t"+x.charAt(0).toUpperCase()+x.slice(1)).classList.add("active")
 render() // sekme deÄŸiÅŸince dropdown gÃ¼ncel
}

function icon(v){ if(v>0) return "red"; if(v<0) return "blue"; return "green" }

function ekle(type,ad,p,u){
 if(!ad) return alert("Ä°sim gir")
 p=Number(p)||0; u=Number(u)||0
 last[type]={p,u}
 data[type].push({ad,paket:p,tutar:p*u})
 save()
}

function duzenleGunluk(type,i){
 let x=data[type][i]
 let ad=prompt("Ad",x.ad); if(ad===null) return
 let paket=prompt("Paket",x.paket); if(paket===null) return
 let tutar=prompt("Tutar",x.tutar); if(tutar===null) return
 x.ad=ad; x.paket=Number(paket); x.tutar=Number(tutar)
 save()
}

function silGunluk(type,i){ if(confirm("GÃ¼nlÃ¼k silinsin mi?")){ data[type].splice(i,1); save() } }

function duzenleDevir(type,i){
 let x=devir[type][i]
 let ad=prompt("Ad",x.ad); if(ad===null) return
 let tutar=prompt("Tutar",x.tutar); if(tutar===null) return
 x.ad=ad; x.tutar=Number(tutar)
 save()
}

function silDevir(type,i){ if(confirm("Devir silinsin mi?")){ devir[type].splice(i,1); save() } }

function gunSonu(){
 ["kurye","isletme"].forEach(t=>{
  let map={}
  data[t].forEach(x=>map[x.ad]=(map[x.ad]||0)+x.tutar)
  Object.entries(map).forEach(([ad,top])=>{
   let d=devir[t].find(x=>x.ad===ad)
   if(d) d.tutar+=top
   else devir[t].push({ad,tutar:top})
  })
  data[t]=[]
 })
 save()
}

// Ã–DEME
function odemeGir(){
 let tip=document.getElementById("odemeTip").value
 let ad=document.getElementById("odemeAd").value
 let tutar=Number(document.getElementById("odemeTutar").value)
 if(!ad || !tutar) return alert("Ä°sim ve tutar gir")
 // GÃ¼nlÃ¼k ve devri dÃ¼ÅŸ
 data[tip].forEach(x=>{ if(x.ad===ad){ x.tutar-=tutar; if(x.tutar<0)x.tutar=0 } })
 devir[tip].forEach(x=>{ if(x.ad===ad){ x.tutar-=tutar; if(x.tutar<0)x.tutar=0 } })
 odemeler.push({tarih:new Date().toLocaleDateString("tr-TR"),tip,ad,tutar})
 save()
}

// TABLOLAR
function tabloGunluk(type){
 return `<table>
 <tr><th></th><th>Ad</th><th>Paket</th><th>Tutar</th><th></th></tr>
 ${data[type].map((x,i)=>`
 <tr>
 <td><span class="icon ${icon(x.tutar)}"></span></td>
 <td>${x.ad}</td>
 <td>${x.paket}</td>
 <td>${x.tutar}</td>
 <td class="actions">
  <button onclick="duzenleGunluk('${type}',${i})">âœï¸</button>
  <button onclick="silGunluk('${type}',${i})">ğŸ—‘ï¸</button>
 </td>
 </tr>`).join("")}
 </table>`
}

function tabloDevir(type){
 return `<table>
 <tr><th></th><th>Ad</th><th>Tutar</th><th></th></tr>
 ${devir[type].map((x,i)=>`
 <tr>
 <td><span class="icon ${icon(x.tutar)}"></span></td>
 <td>${x.ad}</td>
 <td>${x.tutar}</td>
 <td class="actions">
  <button onclick="duzenleDevir('${type}',${i})">âœï¸</button>
  <button onclick="silDevir('${type}',${i})">ğŸ—‘ï¸</button>
 </td>
 </tr>`).join("")}
 </table>`
}

function tabloOdeme(){
 return `<table>
 <tr><th>Tarih</th><th>Tip</th><th>Ad</th><th>Tutar</th></tr>
 ${odemeler.map(o=>`
 <tr>
 <td>${o.tarih}</td>
 <td>${o.tip}</td>
 <td>${o.ad}</td>
 <td>${o.tutar}</td>
 </tr>`).join("")}
 </table>`
}

// EXCEL
function excelAktar(){
 let rows=[]
 const q=v=>`"${v ?? ""}"`
 let tarih=new Date().toLocaleDateString("tr-TR")

 // GÃ¼nlÃ¼k ve devri tek satÄ±r
 ["kurye","isletme"].forEach(t=>{
  data[t].forEach(x=>rows.push([q(tarih),q(t),q(x.ad),q(x.paket),q(x.tutar),""]))
  devir[t].forEach(x=>rows.push([q(tarih),q(t),q(x.ad),"",q(x.tutar),""]))
 })

 // Ã–demeler
 odemeler.forEach(o=>rows.push([q(o.tarih),q(o.tip),q(o.ad),"","",q(o.tutar)]))

 let csv="\uFEFF"+rows.map(r=>r.join(";")).join("\n")
 let blob=new Blob([csv],{type:"text/csv;charset=utf-8;"})
 let url=URL.createObjectURL(blob)
 let a=document.createElement("a")
 a.href=url
 a.download="kurye_isletme_"+tarih+".csv"
 document.body.appendChild(a)
 a.click()
 document.body.removeChild(a)
}

function render(){
 kurye.innerHTML=`
 <div class="card">
 <input id="ka" placeholder="Kurye adÄ±">
 <input type="number" placeholder="Paket" value="${last.kurye.p}" id="kp">
 <input type="number" placeholder="Ãœcret" value="${last.kurye.u}" id="ku">
 <button onclick="ekle('kurye',ka.value,kp.value,ku.value)">GÃœNLÃœK EKLE</button>
 </div>
 <b>GÃ¼nlÃ¼k</b>${tabloGunluk("kurye")}
 <b>Devir</b>${tabloDevir("kurye")}
 `
 isletme.innerHTML=`
 <div class="card">
 <input id="ia" placeholder="Ä°ÅŸletme adÄ±">
 <input type="number" placeholder="Paket" value="${last.isletme.p}" id="ip">
 <input type="number" placeholder="Ãœcret" value="${last.isletme.u}" id="iu">
 <button onclick="ekle('isletme',ia.value,ip.value,iu.value)">GÃœNLÃœK EKLE</button>
 </div>
 <b>GÃ¼nlÃ¼k</b>${tabloGunluk("isletme")}
 <b>Devir</b>${tabloDevir("isletme")}
 `
 // Ã–deme dropdown gÃ¼ncelle
 let sel=document.getElementById("odemeAd")
 sel.innerHTML=""
 let tip=document.getElementById("odemeTip").value
 data[tip].forEach(x=>{ let opt=document.createElement("option"); opt.value=x.ad; opt.text=x.ad; sel.add(opt) })
 odemeTablo.innerHTML=tabloOdeme()
}
document.getElementById("odemeTip").addEventListener("change",render)
render()
</script>

</body>
</html>
