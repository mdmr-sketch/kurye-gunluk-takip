<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kurye & Ä°ÅŸletme Takip</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
:root{
  --bg:#0f172a; --card:#1e293b; --soft:#334155;
  --blue:#3b82f6; --red:#ef4444; --green:#22c55e; --text:#e5e7eb;
}
*{box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:sans-serif;padding:10px;}
input, select, button{border:none;border-radius:8px;padding:8px;margin:4px 0;}
input, select{background:var(--soft);color:#fff;}
button{background:var(--blue);color:#fff;font-weight:bold;}
button.warn{background:#facc15;color:#000;}
button.small{padding:4px 6px;font-size:12px;}
.card{background:var(--card);padding:10px;border-radius:10px;margin-bottom:10px;}
.tabbar{display:flex;gap:6px;margin-bottom:10px;}
.tabbar button{flex:1;padding:10px;font-weight:bold;}
.active{background:var(--blue);}
.passive{background:var(--soft);}
.hidden{display:none;}
table{width:100%;border-collapse:collapse;font-size:12px;margin-top:6px;}
th, td{padding:6px;border-bottom:1px solid var(--soft);text-align:center;}
.icon{width:8px;height:8px;border-radius:50%;display:inline-block;}
.red{background:var(--red);}
.green{background:var(--green);}
.actions button{margin:0 2px;}
.logo{text-align:center;font-size:48px;margin:5px 0;}
.summary{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;}
.summary-card{background:#020617;padding:12px;border-radius:14px;}
.pay{border-left:4px solid var(--red);}
.get{border-left:4px solid var(--green);}
.input-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px;}
.input-row input{flex:1;}
.payment-container{display:flex;flex-direction:column;gap:6px;}
.payment-container button{width:100%;}
</style>
</head>
<body>

<div class="logo">ğŸ›µ</div>

<div class="tabbar">
 <button id="tKurye" class="active" onclick="tab('kurye')">ğŸ›µ KURYELER</button>
 <button id="tIsletme" class="passive" onclick="tab('isletme')">ğŸ• Ä°ÅLETMELER</button>
</div>

<div id="kurye"></div>
<div id="isletme" class="hidden"></div>

<div class="card payment-container">
 <b>ğŸ’³ Ã–DEME</b>
 <select id="odemeTip">
  <option value="kurye">Kurye</option>
  <option value="isletme">Ä°ÅŸletme</option>
 </select>
 <select id="odemeAd"></select>
 <input type="number" id="odemeTutar" placeholder="Tutar">
 <button onclick="odemeGir()">Ã–DEME YAP</button>

 <div class="summary">
  <div class="summary-card pay">Kuryelere: <b id="topKurye">0 â‚º</b></div>
  <div class="summary-card get">Ä°ÅŸletmelerden: <b id="topIsletme">0 â‚º</b></div>
 </div>
</div>

<b>Ã–deme GeÃ§miÅŸi</b>
<div id="odemeTablo"></div>

<div style="display:flex;gap:6px;margin-top:10px;">
 <button class="warn" style="flex:1;" onclick="gunSonu()">GÃœN SONU AL</button>
 <button style="flex:1;" onclick="excelAktar()">ğŸ“¤ EXCEL AKTAR</button>
</div>

<script>
let data = JSON.parse(localStorage.getItem("takip")) || {kurye:[], isletme:[]};
let devir = JSON.parse(localStorage.getItem("devir")) || {kurye:[], isletme:[]};
let odemeler = JSON.parse(localStorage.getItem("odemeler")) || [];
let lastInputs = {kurye:{paket:'', ucret:''}, isletme:{paket:'', ucret:''}};

function save(){
 localStorage.setItem("takip", JSON.stringify(data));
 localStorage.setItem("devir", JSON.stringify(devir));
 localStorage.setItem("odemeler", JSON.stringify(odemeler));
 render();
}

function tab(x){
 kurye.classList.add("hidden");
 isletme.classList.add("hidden");
 tKurye.classList.remove("active");
 tIsletme.classList.remove("active");
 document.getElementById(x).classList.remove("hidden");
 document.getElementById("t"+x.charAt(0).toUpperCase()+x.slice(1)).classList.add("active");
}

function ekle(type, ad, paket, ucret){
 if(!ad) return alert("Ä°sim gir");
 lastInputs[type] = {paket, ucret};
 paket = Number(paket)||0; ucret = Number(ucret)||0;
 let tutar = paket*ucret;
 data[type].push({ad, paket, ucret, tutar, tarih:new Date().toLocaleDateString()});
 save();
}

function odemeGir(){
 let t = odemeTip.value, a = odemeAd.value, tu = +odemeTutar.value;
 if(!a||!tu) return;
 let d = devir[t].find(x=>x.ad===a);
 if(d) d.tutar = Math.max(0,d.tutar-tu);
 odemeler.push({tarih:new Date().toLocaleDateString("tr-TR"), tip:t, ad:a, tutar:tu});
 save();
}

function gunSonu(){
 ["kurye","isletme"].forEach(t=>{
  let m={};
  data[t].forEach(x=> m[x.ad]=(m[x.ad]||0)+x.tutar );
  Object.entries(m).forEach(([ad,top])=>{
   let d = devir[t].find(x=>x.ad===ad);
   if(d) d.tutar += top;
   else devir[t].push({ad, tutar:top});
  });
  data[t] = [];
 });
 save();
}

function excelAktar(){
 let wb=XLSX.utils.book_new();

 let gunluk_kurye = data.kurye.map(x=>({Tarih:x.tarih, Ad:x.ad, Paket:x.paket, Ucret:x.ucret, Toplam:x.tutar}));
 let gunluk_isletme = data.isletme.map(x=>({Tarih:x.tarih, Ad:x.ad, Paket:x.paket, Ucret:x.ucret, Toplam:x.tutar}));
 XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(gunluk_kurye), "GUNLUK_KURYE");
 XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(gunluk_isletme), "GUNLUK_ISLETME");

 let devir_rows = [];
 devir.kurye.forEach(x=> devir_rows.push({Tip:"Kurye", Ad:x.ad, Tutar:x.tutar}));
 devir.isletme.forEach(x=> devir_rows.push({Tip:"Isletme", Ad:x.ad, Tutar:x.tutar}));
 XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(devir_rows), "DEViR");

 XLSX.writeFile(wb, "kurye_takip.xlsx");
}

function tabloGunluk(arr){
 return `<table>
 <tr><th>Tarih</th><th>Ad</th><th>Paket</th><th>Ãœcret</th><th>Toplam</th><th>Ä°ÅŸlem</th></tr>`+
 arr.map((x,i)=>`<tr>
 <td>${x.tarih}</td><td>${x.ad}</td><td>${x.paket}</td><td>${x.ucret}</td><td>${x.tutar}</td>
 <td>
 <button class="small" onclick="promptDuzenle(${i},'${x.ad}','${x.tutar}')">âœï¸</button>
 <button class="small" onclick="sil(${i})">ğŸ—‘ï¸</button>
 </td>
 </tr>`).join('')+`</table>`;
}

function promptDuzenle(i, ad, tutar){
 let yeni = prompt("Yeni tutar", tutar);
 if(yeni!==null){
  let val = Number(yeni)||0;
  data.kurye[i]?data.kurye[i].tutar=val:data.isletme[i].tutar=val;
  save();
 }
}

function sil(i){
 if(confirm("Silinsin mi?")){
  data.kurye[i]?data.kurye.splice(i,1):data.isletme[i].splice(i,1);
  save();
 }
}

function render(){
 // Kurye
 kurye.innerHTML=`
 <div class="card">
  <div class="input-row">
   <input id="ka" placeholder="Kurye AdÄ±" value="${lastInputs.kurye.paket}">
   <input id="kp" type="number" placeholder="Paket" value="${lastInputs.kurye.paket}">
   <input id="ku" type="number" placeholder="Ãœcret" value="${lastInputs.kurye.ucret}">
   <button onclick="ekle('kurye',ka.value,kp.value,ku.value)">EKLE</button>
  </div>
 </div>
 <b>GÃ¼nlÃ¼k KayÄ±tlar</b>${tabloGunluk(data.kurye)}
 <b>Devir</b><table><tr><th>Ad</th><th>Toplam</th></tr>`+
 devir.kurye.map(x=>`<tr><td>${x.ad}</td><td>${x.tutar}</td></tr>`).join('')+
 `</table>`;

 // Isletme
 isletme.innerHTML=`
 <div class="card">
  <div class="input-row">
   <input id="ia" placeholder="Ä°ÅŸletme AdÄ±" value="${lastInputs.isletme.paket}">
   <input id="ip" type="number" placeholder="Paket" value="${lastInputs.isletme.paket}">
   <input id="iu" type="number" placeholder="Ãœcret" value="${lastInputs.isletme.ucret}">
   <button onclick="ekle('isletme',ia.value,ip.value,iu.value)">EKLE</button>
  </div>
 </div>
 <b>GÃ¼nlÃ¼k KayÄ±tlar</b>${tabloGunluk(data.isletme)}
 <b>Devir</b><table><tr><th>Ad</th><th>Toplam</th></tr>`+
 devir.isletme.map(x=>`<tr><td>${x.ad}</td><td>${x.tutar}</td></tr>`).join('')+
 `</table>`;

 topKurye.innerText = devir.kurye.reduce((a,b)=>a+b.tutar,0)+" â‚º";
 topIsletme.innerText = devir.isletme.reduce((a,b)=>a+b.tutar,0)+" â‚º";

 odemeAd.innerHTML="";
 new Set(devir[odemeTip.value].map(x=>x.ad)).forEach(a=>odemeAd.add(new Option(a,a)));

 odemeTablo.innerHTML = `<table>
 <tr><th>Tarih</th><th>Tip</th><th>Ad</th><th>Tutar</th></tr>`+
 odemeler.map(o=>`<tr><td>${o.tarih}</td><td>${o.tip}</td><td>${o.ad}</td><td>${o.tutar}</td></tr>`).join('')+
 `</table>`;
}
odemeTip.onchange=render;
render();
</script>
</body>
</html>
