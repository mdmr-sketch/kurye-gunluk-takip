<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kurye GÃ¼nlÃ¼k Takip</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
body { font-family: Arial; padding: 10px; }
input, button { margin: 4px 0; width: 100%; padding: 6px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
</style>
</head>

<body>

<h3>ðŸ“¦ Kurye GÃ¼nlÃ¼k Takip</h3>

<input id="isletme" placeholder="Ä°ÅŸletme adÄ±">
<input id="paket" type="number" placeholder="AtÄ±lan paket sayÄ±sÄ±">
<input id="ucret" type="number" placeholder="Paket Ã¼creti (TL)">
<input id="tahsilat" type="number" placeholder="Tahsil edilen (opsiyonel)">
<button onclick="ekle()">Kaydet</button>

<h4>ðŸ“‹ GÃ¼nlÃ¼k Liste</h4>
<table>
<thead>
<tr>
<th>Ä°ÅŸletme</th>
<th>Paket</th>
<th>Birim</th>
<th>Tutar</th>
<th>Tahsilat</th>
</tr>
</thead>
<tbody id="liste"></tbody>
</table>

<h4>ðŸ“Š GÃ¼n Sonu</h4>
<p>Toplam Paket: <span id="toplamPaket">0</span></p>
<p>Toplam Alacak: <span id="toplamTL">0</span> TL</p>

<button onclick="gunBitir()">ðŸ“¥ GÃ¼nÃ¼ Bitir & Excel</button>

<script>
let kayitlar = [];
let devirler = JSON.parse(localStorage.getItem("isletmeDevirleri")) || {};

function ekle() {
  const isletme = document.getElementById("isletme").value;
  const paket = Number(document.getElementById("paket").value);
  const ucret = Number(document.getElementById("ucret").value);
  const tahsilat = Number(document.getElementById("tahsilat").value || 0);

  if (!isletme || paket <= 0 || ucret <= 0) return alert("Bilgiler eksik");

  const tutar = paket * ucret;

  if (!devirler[isletme]) devirler[isletme] = 0;
  devirler[isletme] += tutar - tahsilat;

  kayitlar.push({
    Isletme: isletme,
    Paket: paket,
    Birim: ucret,
    Tutar: tutar,
    Tahsilat: tahsilat
  });

  listele();
}

function listele() {
  const tbody = document.getElementById("liste");
  tbody.innerHTML = "";

  let toplamP = 0, toplamT = 0;

  kayitlar.forEach(k => {
    toplamP += k.Paket;
    toplamT += k.Tutar;

    tbody.innerHTML += `
      <tr>
        <td>${k.Isletme}</td>
        <td>${k.Paket}</td>
        <td>${k.Birim}</td>
        <td>${k.Tutar}</td>
        <td>${k.Tahsilat}</td>
      </tr>`;
  });

  document.getElementById("toplamPaket").innerText = toplamP;
  document.getElementById("toplamTL").innerText = toplamT;
}

function gunBitir() {
  const wb = XLSX.utils.book_new();

  const ws1 = XLSX.utils.json_to_sheet(kayitlar);
  XLSX.utils.book_append_sheet(wb, ws1, "Gunluk_Kayitlar");

  const devirSheet = [];
  for (let i in devirler) {
    devirSheet.push({ Isletme: i, KalanDevirTL: devirler[i] });
  }

  const ws2 = XLSX.utils.json_to_sheet(devirSheet);
  XLSX.utils.book_append_sheet(wb, ws2, "Devirler");

  const tarih = new Date().toISOString().slice(0,10);
  XLSX.writeFile(wb, `kurye_${tarih}.xlsx`);

  localStorage.setItem("isletmeDevirleri", JSON.stringify(devirler));
  kayitlar = [];
  listele();
}
</script>

</body>
</html>
